<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accesso Quiz Protetto - ExamLock</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .login-container {
            max-width: 500px;
            margin: 50px auto;
            padding: 30px;
        }
        
        .instructions {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        
        .instructions ul {
            margin: 10px 0 10px 20px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }
        
        .form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }
        
        .btn-start {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #4285f4, #34a853);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s;
        }
        
        .btn-start:hover {
            background: linear-gradient(135deg, #3367d6, #2e8b57);
            transform: translateY(-2px);
            box-shadow: 0 7px 14px rgba(66, 133, 244, 0.3);
        }
        
        .warning-box {
            background: #ffeaea;
            border: 2px solid #ff4444;
            border-radius: 10px;
            padding: 20px;
            margin: 25px 0;
            text-align: center;
        }
        
        .teacher-note {
            margin-top: 30px;
            padding: 15px;
            background: #e8f4fd;
            border-radius: 8px;
            font-size: 14px;
            color: #666;
        }
        
        .link-note {
            background: #e8f5e9;
            border: 2px dashed #34a853;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .link-note code {
            background: #333;
            color: #4cd137;
            padding: 5px 10px;
            border-radius: 4px;
            font-family: monospace;
            word-break: break-all;
            display: block;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container login-container">
        <div class="header">
            <h1>üõ°Ô∏è Accesso Quiz Protetto</h1>
            <p class="subtitle">Sistema ExamLock - Verifica Controllata</p>
        </div>
        
        <div class="instructions">
            <h3>‚ö†Ô∏è IMPORTANTE - Leggere prima di iniziare</h3>
            <p>Questo sistema attiva protezioni anti-copia:</p>
            <ul>
                <li>Schermo intero obbligatorio</li>
                <li>Blocco tasti di scelta rapida (F12, Ctrl+Shift+I, ecc.)</li>
                <li>Rilevamento uscita dalla pagina</li>
                <li>Timer di 30 minuti</li>
                <li>Registro attivit√† sospette</li>
            </ul>
            <p><strong>Non uscire dalla finestra durante il quiz!</strong></p>
        </div>
        
        <div class="card">
            <h2>üìù Identificazione Studente</h2>
            
            <form id="loginForm">
                <div class="form-group">
                    <label for="studentName">Nome:</label>
                    <input type="text" id="studentName" required 
                           placeholder="Es: Mario" autocomplete="off" autofocus>
                </div>
                
                <div class="form-group">
                    <label for="studentSurname">Cognome:</label>
                    <input type="text" id="studentSurname" required 
                           placeholder="Es: Rossi" autocomplete="off">
                </div>
                
                <div class="form-group">
                    <label for="studentClass">Classe:</label>
                    <input type="text" id="studentClass" required 
                           placeholder="Es: 3A" autocomplete="off">
                </div>
                
                <div class="link-note">
                    <p><strong>üîó Link del Quiz (configurato dall'insegnante):</strong></p>
                    <!-- ‚ö†Ô∏è SOSTITUISCI QUESTO LINK CON IL TUO GOOGLE FORM ‚ö†Ô∏è -->
                    <code id="quizLinkDisplay">https://forms.gle/TUO_LINK_QUI</code>
                    <small>Questo link apre il Google Form del quiz</small>
                    <input type="hidden" id="quizUrl" value="https://docs.google.com/forms/d/e/1FAIpQLSevHhPLA7B9Np_u-4kpEEamHQTnigom5_gX2FNn95czc7vcMA/viewform?usp=sharing&ouid=117361936009458106650">
                </div>
                
                <div class="warning-box">
                    <h3>üö® AVVISO SICUREZZA</h3>
                    <p>Il sistema registrer√†:</p>
                    <ul style="text-align: left;">
                        <li>Le attivit√† sospette (cambio tab, uscite, ecc.)</li>
                        <li>L'orario di inizio e fine</li>
                        <li>Eventuali tentativi di bypass delle protezioni</li>
                    </ul>
                    <p style="margin-top: 10px; color: #ff4444; font-weight: bold;">
                        ‚ö†Ô∏è 3 violazioni = Quiz invalidato automaticamente
                    </p>
                </div>
                
                <div class="form-group">
                    <input type="checkbox" id="agreeTerms" required>
                    <label for="agreeTerms" style="display: inline; font-size: 14px;">
                        Confermo di aver letto le istruzioni e accetto le condizioni di utilizzo.
                        Sono consapevole che attivit√† sospette verranno registrate.
                    </label>
                </div>
                
                <button type="submit" class="btn-start">
                    üöÄ INIZIA QUIZ IN MODALIT√Ä PROTETTA
                </button>
            </form>
        </div>
        
        <div class="teacher-note">
            <p><strong>üîß Per l'insegnante (configurazione):</strong></p>
            <p>Per cambiare il Google Form, modifica il file <code>index.html</code></p>
            <p>Cerca: <code>value="https://forms.gle/TUO_LINK_QUI"</code> (riga 99) e sostituisci con il tuo link.</p>
            <p><a href="dashboard.html" style="color: #4285f4; font-weight: bold;">üìä Vai alla Dashboard di monitoraggio</a></p>
        </div>
    </div>

    <script>
        // Rileva dispositivo mobile
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        
        // Carica URL salvato se esiste
        window.addEventListener('load', function() {
            const savedUrl = localStorage.getItem('examlock_quiz_url');
            if (savedUrl) {
                document.getElementById('quizUrl').value = savedUrl;
                document.getElementById('quizLinkDisplay').textContent = savedUrl;
            }
        });
        
        // Gestione invio form
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Recupera dati
            const studentData = {
                name: document.getElementById('studentName').value.trim(),
                surname: document.getElementById('studentSurname').value.trim(),
                class: document.getElementById('studentClass').value.trim(),
                quizUrl: document.getElementById('quizUrl').value,
                device: isMobile ? 'mobile' : 'desktop',
                userAgent: navigator.userAgent,
                screenSize: `${screen.width}x${screen.height}`,
                sessionId: Date.now().toString(36) + Math.random().toString(36).substr(2, 5),
                startTime: new Date().toISOString(),
                violations: []
            };
            
            // Validazione
            if (!studentData.name || !studentData.surname || !studentData.class) {
                alert('‚ö†Ô∏è Compila tutti i campi: Nome, Cognome e Classe');
                return;
            }
            
            if (!studentData.quizUrl || !studentData.quizUrl.includes('http')) {
                alert('‚ö†Ô∏è Link del quiz non valido. Contatta l\'insegnante.');
                return;
            }
            
            console.log('üìù Dati studente salvati:', studentData.name, studentData.surname);
            
            // Salva nei localStorage
            localStorage.setItem('examlock_student', JSON.stringify(studentData));
            localStorage.setItem('examlock_session_id', studentData.sessionId);
            
            // Apri quiz-locked.html come POPUP a SCHERMO INTERO
            const width = screen.width;
            const height = screen.height;
            
            const popup = window.open(
                'quiz-locked.html',
                'QuizLockedWindow',
                `width=${width},height=${height},left=0,top=0,` +
                `scrollbars=no,toolbar=no,menubar=no,status=no,location=no,resizable=no`
            );
            
            if (popup) {
                console.log('‚úÖ Popup aperto con successo');
                // Chiudi questa finestra dopo 1 secondo
                setTimeout(() => {
                    window.close();
                }, 1000);
            } else {
                // Popup bloccato
                alert('‚ùå IL BROWSER HA BLOCCATO IL POPUP!\n\n' +
                      'Per risolvere:\n' +
                      '1. Cerca l\'icona üõ°Ô∏è o "Pop-up bloccati" nella barra degli indirizzi\n' +
                      '2. Clicca e seleziona "Consenti sempre i popup"\n' +
                      '3. Ricarica questa pagina e riprova');
            }
        });
        
        // Tasti rapidi per debug (Ctrl+Shift+D = reset)
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.shiftKey && e.key === 'D') {
                e.preventDefault();
                if (confirm('Reset completo? Canceller√† tutti i dati.')) {
                    localStorage.clear();
                    alert('Dati cancellati. La pagina si ricaricher√†.');
                    location.reload();
                }
            }
        });
    </script>
</body>
</html>